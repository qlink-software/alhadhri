<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="qlk_executive_dashboard.ExecutiveDashboard" owl="1">
        <div class="qlk-executive-dashboard" t-att-style="paletteStyle">
            <t t-if="state.loading">
                <div class="qlk-dashboard__loading">
                    <div class="spinner-border text-light" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <span>Building executive insights...</span>
                </div>
            </t>
            <t t-else="">
                <header class="exec-header">
                    <div>
                        <p class="eyebrow">Executive overview</p>
                        <h1>Executive Dashboard</h1>
                        <p>BI-grade insights across cases, sessions, memos, and approvals.</p>
                    </div>
                    <div class="exec-meta">
                        <span t-esc="state.data.user.company"/>
                        <strong t-esc="state.data.user.name"/>
                    </div>
                </header>

                <section class="exec-kpi-grid">
                    <t t-foreach="kpis" t-as="card" t-key="card.key">
                        <button type="button" class="exec-kpi-card"
                                t-on-click="() => openAction(card.action, card.domain)">
                            <div class="kpi-indicator" t-att-style="'background:' + (card.color || '#1F6FEB')"></div>
                            <div class="kpi-icon" t-att-style="'background:' + (card.color || '#1F6FEB')">
                                <i t-att-class="'fa ' + (card.icon || 'fa-chart-bar')"></i>
                            </div>
                            <div class="kpi-info">
                                <span class="kpi-label"><t t-esc="card.label"/></span>
                                <strong class="kpi-value"><t t-esc="card.value"/></strong>
                                <span class="kpi-tag" t-esc="card.tag"/>
                            </div>
                        </button>
                    </t>
                </section>

                <section class="exec-main-grid">
                    <article class="exec-card chart-card" t-if="charts.cases_by_stage">
                        <header>
                            <div>
                                <h3>Cases by Stage</h3>
                                <small>Vertical bar chart</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(charts.cases_by_stage.action)">
                                View
                            </button>
                        </header>
                        <div class="chart-wrapper tall">
                            <canvas t-ref="casesByStageCanvas"></canvas>
                        </div>
                    </article>

                    <article class="exec-card chart-card" t-if="charts.courts_distribution">
                        <header>
                            <div>
                                <h3>Distribution by Court</h3>
                                <small>Donut chart</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(charts.courts_distribution.action)">
                                View
                            </button>
                        </header>
                        <div class="chart-wrapper donut">
                            <canvas t-ref="courtsDistributionCanvas"></canvas>
                        </div>
                    </article>

                    <aside class="exec-card metrics-card">
                        <header>
                            <h3>Performance Indicators</h3>
                            <small>Operational KPIs</small>
                        </header>
                        <ul class="metric-list">
                            <t t-foreach="sideMetrics" t-as="metric" t-key="metric.label">
                                <li>
                                    <span class="metric-icon">
                                        <i t-att-class="'fa ' + metric.icon"></i>
                                    </span>
                                    <div class="metric-data">
                                        <strong t-esc="metric.value"/>
                                        <span t-esc="metric.label"/>
                                    </div>
                                </li>
                            </t>
                        </ul>
                    </aside>
                </section>

                <section class="exec-analytics-grid">
                    <article class="exec-card chart-card" t-if="charts.cases_trend">
                        <header>
                            <div>
                                <h3>Case Creation Trend</h3>
                                <small>Line chart</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(charts.cases_trend.action)">
                                View
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="casesTrendCanvas"></canvas>
                        </div>
                    </article>

                    <article class="exec-card chart-card" t-if="charts.sessions_by_status">
                        <header>
                            <div>
                                <h3>Sessions by Status</h3>
                                <small>Bar chart</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(charts.sessions_by_status.action)">
                                View
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="sessionsByStatusCanvas"></canvas>
                        </div>
                    </article>

                    <article class="exec-card chart-card" t-if="charts.memos_by_type">
                        <header>
                            <div>
                                <h3>Memos by Type</h3>
                                <small>Pie chart</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(charts.memos_by_type.action)">
                                View
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="memosByTypeCanvas"></canvas>
                        </div>
                    </article>

                    <article class="exec-card chart-card" t-if="charts.lawyer_workload">
                        <header>
                            <div>
                                <h3>Lawyer Workload</h3>
                                <small>Stacked bar chart</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(charts.lawyer_workload.action)">
                                View
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="lawyerWorkloadCanvas"></canvas>
                        </div>
                    </article>
                </section>

                <section class="exec-table-grid">
                    <article class="exec-card table-card" t-if="tables.cases">
                        <header>
                            <div>
                                <h3 t-esc="tables.cases.title"/>
                                <small>Reference, client, status</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(tables.cases.action)">
                                View all
                            </button>
                        </header>
                        <table t-if="tables.cases.rows.length">
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Client</th>
                                    <th>Status</th>
                                    <th>Stage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="tables.cases.rows" t-as="row" t-key="row.id">
                                    <tr class="is-clickable" t-on-click="() => openRecord(row.url)">
                                        <td t-esc="row.reference"/>
                                        <td t-esc="row.client"/>
                                        <td t-esc="row.meta"/>
                                        <td>
                                            <span class="status-badge" t-att-style="'background:' + row.badge_color">
                                                <t t-esc="row.stage"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <div t-else="" class="qlk-empty">No cases to display.</div>
                    </article>

                    <article class="exec-card table-card" t-if="tables.sessions">
                        <header>
                            <div>
                                <h3 t-esc="tables.sessions.title"/>
                                <small>Upcoming and recent sessions</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(tables.sessions.action)">
                                View all
                            </button>
                        </header>
                        <table t-if="tables.sessions.rows.length">
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Client</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="tables.sessions.rows" t-as="row" t-key="row.id">
                                    <tr class="is-clickable" t-on-click="() => openRecord(row.url)">
                                        <td t-esc="row.reference"/>
                                        <td t-esc="row.client"/>
                                        <td t-esc="row.meta"/>
                                        <td>
                                            <span class="status-badge" t-att-style="'background:' + row.badge_color">
                                                <t t-esc="row.stage"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <div t-else="" class="qlk-empty">No sessions to display.</div>
                    </article>

                    <article class="exec-card table-card" t-if="tables.memos">
                        <header>
                            <div>
                                <h3 t-esc="tables.memos.title"/>
                                <small>Latest memos</small>
                            </div>
                            <button type="button" class="exec-link" t-on-click="() => openAction(tables.memos.action)">
                                View all
                            </button>
                        </header>
                        <table t-if="tables.memos.rows.length">
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Client</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="tables.memos.rows" t-as="row" t-key="row.id">
                                    <tr class="is-clickable" t-on-click="() => openRecord(row.url)">
                                        <td t-esc="row.reference"/>
                                        <td t-esc="row.client"/>
                                        <td t-esc="row.meta"/>
                                        <td>
                                            <span class="status-badge" t-att-style="'background:' + row.badge_color">
                                                <t t-esc="row.stage"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <div t-else="" class="qlk-empty">No memos to display.</div>
                    </article>
                </section>
            </t>
        </div>
    </t>
</templates>
