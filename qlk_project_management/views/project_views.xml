<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="view_qlk_project_tree" model="ir.ui.view">
            <field name="name">qlk.project.list</field>
            <field name="model">qlk.project</field>
            <field name="type">list</field>
            <field name="arch" type="xml">
                <list string="Projects" default_order="create_date desc">
                    <field name="code"/>
                    <field name="name"/>
                    <field name="department" widget="badge"/>
                    <field name="stage_id"/>
                    <field name="client_id"/>
                    <field name="case_id"/>
                    <field name="engagement_id"/>
                    <field name="assigned_employee_ids"/>
                    <field name="task_hours_total"/>
                    <field name="poa_state" widget="badge"/>
                    <field name="transfer_ready"/>
                </list>
            </field>
        </record>

        <record id="view_qlk_project_form" model="ir.ui.view">
            <field name="name">qlk.project.form</field>
            <field name="model">qlk.project</field>
            <field name="arch" type="xml">
                <form string="Project">
                    <header>
                        <button name="action_previous_stage" type="object" string="Previous Stage" class="btn-secondary"/>
                        <button name="action_next_stage" type="object" string="Next Stage" class="btn-primary"/>
                        <button name="action_mark_stage_completed" type="object" string="Mark Stage Complete" class="btn-light"
                                invisible="stage_completed_on"/>
                        <button name="action_request_poa" type="object" string="Request POA" class="btn-warning"
                                invisible="department != 'pre_litigation' or poa_state != 'draft'"/>
                        <button name="action_mark_poa_received" type="object" string="POA Received" class="btn-primary"
                                invisible="department != 'pre_litigation' or poa_state != 'requested'"/>
                        <button name="action_mark_poa_uploaded" type="object" string="POA Uploaded" class="btn-success"
                                invisible="department != 'pre_litigation' or (poa_state != 'received' and poa_state != 'uploaded')"/>
                        <button name="action_transfer_to_litigation" type="object" string="Transfer to Litigation"
                                class="btn-primary"
                                modifiers="{'invisible': ['|', ('department', 'not in', ['pre_litigation', 'litigation']), ('case_id', '!=', False)]}"/>
                        <field name="stage_id" widget="statusbar"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name"/>
                            </h1>
                            <h2>
                                <field name="code" readonly="1"/>
                            </h2>
                        </div>

                        <div class="oe_button_box" name="button_box">
                            <button type="object" class="oe_stat_button" name="action_view_tasks" icon="fa-tasks">
                                <field name="task_hours_total" string="Approved Hours"/>
                            </button>
                            <button type="object" class="oe_stat_button" name="action_view_stage_logs" icon="fa-line-chart">
                                <field name="stage_log_count" string="Stage Logs"/>
                            </button>
                        </div>

                        <group>
                            <group>
                                <field name="department"/>
                                <field name="stage_id" readonly="1"/>
                                <field name="client_id"/>
                                <field name="engagement_id"/>
                                <field name="case_id" readonly="department != 'litigation'"/>
                                <field name="assigned_employee_ids" widget="many2many_tags"/>
                                <field name="owner_id"/>
                            </group>
                            <group>
                                <field name="poa_state" widget="badge"/>
                                <field name="poa_requested_on" readonly="1"/>
                                <field name="poa_received_on" readonly="1"/>
                                <field name="deadline"/>
                                <field name="transfer_ready"/>
                                <field name="stage_started_on" readonly="1"/>
                                <field name="stage_completed_on" readonly="1"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Description">
                                <field name="description" widget="html"/>
                            </page>
                            <page string="POA Documents" invisible="department != 'pre_litigation'">
                                <field name="poa_attachment_ids" widget="many2many_binary"/>
                            </page>
                            <page string="Tasks">
                                <field name="task_ids" context="{'default_project_id': id}" nolabel="1">
                                    <list editable="bottom" default_order="date_start desc">
                                        <field name="approval_state" readonly="1"/>
                                        <field name="name"/>
                                        <field name="department"/>
                                        <field name="employee_id"/>
                                        <field name="hours_spent"/>
                                        <field name="date_start"/>
                                        <field name="date_finished"/>
                                        <field name="reviewer_id"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Stage Timeline">
                                <field name="stage_log_ids" nolabel="1">
                                    <list>
                                        <field name="stage_id"/>
                                        <field name="date_start"/>
                                        <field name="date_end"/>
                                        <field name="duration_days"/>
                                        <field name="completed_by"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Notes">
                                <field name="notes"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_qlk_project_search" model="ir.ui.view">
            <field name="name">qlk.project.search</field>
            <field name="model">qlk.project</field>
            <field name="arch" type="xml">
                <search string="Projects">
                    <field name="name" filter_domain="[('name', 'ilike', self)]"/>
                    <field name="code" filter_domain="[('code', 'ilike', self)]"/>
                    <field name="client_id"/>
                    <field name="department"/>
                    <field name="stage_id"/>
                    <field name="case_id"/>
                    <filter name="filter_my_projects" string="My Projects"
                            domain="['|', ('assigned_employee_ids.user_id', '=', uid), ('owner_id', '=', uid)]"/>
                    <filter name="filter_transfer_ready" string="Ready for Litigation" domain="[('transfer_ready', '=', True)]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_department" string="Department" context="{'group_by': 'department'}"/>
                        <filter name="group_stage" string="Stage" context="{'group_by': 'stage_id'}"/>
                        <filter name="group_client" string="Client" context="{'group_by': 'client_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_qlk_project" model="ir.actions.act_window">
            <field name="name">Projects</field>
            <field name="res_model">qlk.project</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'search_default_filter_my_projects': 1, 'search_default_group_stage': 1}</field>
        </record>

        <record id="action_qlk_project_tasks" model="ir.actions.act_window">
            <field name="name">Project Tasks</field>
            <field name="res_model">qlk.task</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('project_id', '!=', False)]</field>
            <field name="context">{'search_default_group_project': 1}</field>
        </record>

        <record id="action_qlk_project_hours" model="ir.actions.act_window">
            <field name="name">Project Hours</field>
            <field name="res_model">qlk.task</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('project_id', '!=', False), ('approval_state', '=', 'approved')]</field>
            <field name="context">{'search_default_group_project': 1}</field>
        </record>

        <record id="action_qlk_project_pre_litigation" model="ir.actions.act_window">
            <field name="name">Pre-Litigation Pipeline</field>
            <field name="res_model">qlk.project</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('department', '=', 'pre_litigation')]</field>
            <field name="context">{'default_department': 'pre_litigation', 'search_default_group_stage': 1}</field>
        </record>

        <record id="action_qlk_project_litigation" model="ir.actions.act_window">
            <field name="name">Litigation Pipeline</field>
            <field name="res_model">qlk.project</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('department', '=', 'litigation')]</field>
            <field name="context">{'default_department': 'litigation', 'search_default_group_stage': 1}</field>
        </record>

        <record id="action_qlk_project_corporate" model="ir.actions.act_window">
            <field name="name">Corporate Pipeline</field>
            <field name="res_model">qlk.project</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('department', '=', 'corporate')]</field>
            <field name="context">{'default_department': 'corporate', 'search_default_group_stage': 1}</field>
        </record>

        <record id="action_qlk_project_arbitration" model="ir.actions.act_window">
            <field name="name">Arbitration Pipeline</field>
            <field name="res_model">qlk.project</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('department', '=', 'arbitration')]</field>
            <field name="context">{'default_department': 'arbitration', 'search_default_group_stage': 1}</field>
        </record>

    </data>
</odoo>
