<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="qlk_project_management.AnalysisDashboard" owl="1">
        <div class="qlk-analysis-dashboard"
             t-att-style="'--qlk-primary: ' + (palette.primary || '#0F5CA8') + '; --qlk-accent: ' + (palette.accent || '#22B6C8') + '; --qlk-muted: ' + (palette.muted || '#0D3E7A') + '; --qlk-success: ' + (palette.success || '#27AE60') + ';'">
            <t t-if="state.loading">
                <div class="qlk-dashboard__loading">
                    <div class="spinner-border text-light" role="status">
                        <span class="sr-only">جار التحميل...</span>
                    </div>
                    <span>جار التحميل...</span>
                </div>
            </t>
            <t t-else="">
                <section class="qlk-analysis__hero">
                    <div class="hero__info">
                        <h1>اللوحة التحليلية الشاملة</h1>
                        <p>عرض تحليلي لكل القضايا والجلسات والاستشارات والبلاغات والمشاريع.</p>
                    </div>
                    <div class="hero__filters">
                        <span>نطاق زمني</span>
                        <div class="filter-group">
                            <t t-foreach="periods" t-as="period" t-key="period">
                                <button type="button"
                                        t-att-class="isActivePeriod(period) ? 'filter-chip active' : 'filter-chip'"
                                        t-on-click="() => this.changePeriod(period)">
                                    <t t-esc="period"/> شهرًا
                                </button>
                            </t>
                        </div>
                    </div>
                    <div class="hero__metrics">
                        <div class="metric-card">
                            <span>القضايا</span>
                            <strong t-esc="totals.cases || 0"/>
                        </div>
                        <div class="metric-card">
                            <span>الجلسات</span>
                            <strong t-esc="totals.hearings || 0"/>
                        </div>
                        <div class="metric-card">
                            <span>الاستشارات</span>
                            <strong t-esc="totals.consultations || 0"/>
                        </div>
                        <div class="metric-card">
                            <span>البلاغات</span>
                            <strong t-esc="totals.complaints || 0"/>
                        </div>
                        <div class="metric-card">
                            <span>المشاريع</span>
                            <strong t-esc="totals.projects || 0"/>
                        </div>
                    </div>
                </section>

                <section class="qlk-analysis__grid">
                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>القضايا الشهرية</h2>
                            </div>
                            <button t-if="state.data.actions.cases" class="qlk-link" t-on-click="() => openAction(state.data.actions.cases)">
                                عرض القضايا
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="casesCanvas"></canvas>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>الجلسات</h2>
                            </div>
                            <button t-if="state.data.actions.hearings" class="qlk-link" t-on-click="() => openAction(state.data.actions.hearings)">
                                عرض الجلسات
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="hearingsCanvas"></canvas>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>الاستشارات</h2>
                            </div>
                            <button t-if="state.data.actions.consultations" class="qlk-link" t-on-click="() => openAction(state.data.actions.consultations)">
                                عرض الاستشارات
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <t t-if="series.consultations and series.consultations.length">
                                <canvas t-ref="consultationsCanvas"></canvas>
                            </t>
                            <div t-else="" class="qlk-empty">لا توجد بيانات للاستشارات.</div>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>بلاغات الشرطة</h2>
                            </div>
                            <button t-if="state.data.actions.complaints" class="qlk-link" t-on-click="() => openAction(state.data.actions.complaints)">
                                عرض البلاغات
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <t t-if="series.complaints and series.complaints.length">
                                <canvas t-ref="complaintsCanvas"></canvas>
                            </t>
                            <div t-else="" class="qlk-empty">لا توجد بيانات للبلاغات.</div>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>المشاريع الجديدة</h2>
                            </div>
                            <button t-if="state.data.actions.projects" class="qlk-link" t-on-click="() => openAction(state.data.actions.projects)">
                                عرض المشاريع
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="projectsCanvas"></canvas>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>الساعات المعتمدة للمشاريع</h2>
                            </div>
                            <button t-if="state.data.actions.tasks" class="qlk-link" t-on-click="() => openAction(state.data.actions.tasks)">
                                عرض المهام
                            </button>
                        </header>
                        <div class="chart-wrapper">
                            <canvas t-ref="taskHoursCanvas"></canvas>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>توزيع حالات القضايا</h2>
                            </div>
                        </header>
                        <div class="chart-wrapper">
                            <t t-if="series.case_status and series.case_status.length">
                                <canvas t-ref="caseStatusCanvas"></canvas>
                            </t>
                            <div t-else="" class="qlk-empty">لا توجد بيانات للحالات.</div>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>حالات الجلسات</h2>
                            </div>
                        </header>
                        <div class="chart-wrapper">
                            <t t-if="series.hearing_stage and series.hearing_stage.length">
                                <canvas t-ref="hearingStageCanvas"></canvas>
                            </t>
                            <div t-else="" class="qlk-empty">لا توجد بيانات.</div>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>تقدم المشاريع</h2>
                            </div>
                        </header>
                        <div class="chart-wrapper">
                            <t t-if="series.project_progress and series.project_progress.length">
                                <canvas t-ref="projectProgressCanvas"></canvas>
                            </t>
                            <div t-else="" class="qlk-empty">لا توجد بيانات للمشاريع.</div>
                        </div>
                    </article>

                    <article class="qlk-card">
                        <header>
                            <div>
                                <h2>المهام حسب القسم</h2>
                            </div>
                        </header>
                        <div class="chart-wrapper">
                            <t t-if="series.task_department and series.task_department.length">
                                <canvas t-ref="taskDepartmentCanvas"></canvas>
                            </t>
                            <div t-else="" class="qlk-empty">لا توجد بيانات.</div>
                        </div>
                    </article>
                </section>
            </t>
        </div>
    </t>
</templates>
