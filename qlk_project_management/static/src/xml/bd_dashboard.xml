<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="qlk_project_management.BDDashboard" owl="1">
        <div class="bd-hub"
             t-att-style="'--bd-color-primary:' + (palette.primary || '#0d1b2a') + '; --bd-color-accent:' + (palette.accent || '#1b263b') + '; --bd-color-muted:' + (palette.muted || '#415a77') + '; --bd-color-success:' + (palette.success || '#22c55e') + ';'">
            <t t-if="state.loading">
                <div class="bd-hub__loading">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"/>
                    <span>Loading BD intelligenceâ€¦</span>
                </div>
            </t>
            <t t-else="">
                <section class="bd-hub__summary">
                    <t t-foreach="summaryCards" t-as="card" t-key="card.title">
                        <div class="summary-card">
                            <span class="summary-card__label" t-esc="card.title"/>
                            <strong class="summary-card__value" t-esc="card.value"/>
                            <small class="summary-card__hint" t-esc="card.caption"/>
                        </div>
                    </t>
                </section>

                <section class="bd-hub__grid">
                    <article class="bd-panel bd-panel--wide">
                        <header class="bd-panel__header">
                            <div>
                                <h2 t-esc="pipeline.title"/>
                                <p>High-level overview for live negotiations.</p>
                            </div>
                            <button t-if="pipeline.action"
                                    class="bd-link"
                                    type="button"
                                    t-on-click="() => openAction(pipeline.action, pipeline.domain)">
                                View pipeline
                            </button>
                        </header>
                        <t t-if="pipeline.records.length">
                            <table class="bd-table">
                                <thead>
                                    <tr>
                                        <th>Deal</th>
                                        <th>Client</th>
                                        <th>Stage</th>
                                        <th>Amount</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="pipeline.records" t-as="record" t-key="record.id">
                                        <tr t-on-click="() => openRecord(record.url)">
                                            <td class="bd-table__title" t-esc="record.name"/>
                                            <td t-esc="record.client or '-'"/>
                                            <td>
                                                <span class="badge badge--info" t-esc="record.stage"/>
                                            </td>
                                            <td class="bd-table__metric" t-esc="record.amount_display"/>
                                            <td t-esc="record.date"/>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <div class="bd-empty">No pipeline records available.</div>
                        </t>
                    </article>

                    <article class="bd-panel">
                        <header class="bd-panel__header">
                            <div>
                                <h2 t-esc="agreements.title"/>
                                <p>Latest agreements that moved to done.</p>
                            </div>
                            <button t-if="agreements.action"
                                    class="bd-link"
                                    type="button"
                                    t-on-click="() => openAction(agreements.action)">
                                Open agreements
                            </button>
                        </header>
                        <t t-if="agreements.records.length">
                            <ul class="bd-list">
                                <t t-foreach="agreements.records" t-as="ag" t-key="ag.id">
                                    <li class="bd-list__item" t-on-click="() => openRecord(ag.url)">
                                        <div>
                                            <strong t-esc="ag.name"/>
                                            <span t-esc="ag.client"/>
                                        </div>
                                        <div class="bd-list__meta">
                                            <span class="badge" t-esc="ag.status"/>
                                            <small t-esc="ag.start"/> â†’ <small t-esc="ag.end"/>
                                        </div>
                                    </li>
                                </t>
                            </ul>
                        </t>
                        <t t-else="">
                            <div class="bd-empty">No agreements have been signed recently.</div>
                        </t>
                    </article>
                </section>

                <section class="bd-hub__grid bd-hub__grid--secondary">
                    <article class="bd-panel">
                        <header class="bd-panel__header">
                            <div>
                                <h2 t-esc="documents.title"/>
                                <p>Documents approaching expiration.</p>
                            </div>
                            <button t-if="documents.action"
                                    class="bd-link"
                                    type="button"
                                    t-on-click="() => openAction(documents.action, documents.domain)">
                                Review documents
                            </button>
                        </header>
                        <t t-if="documents.records.length">
                            <table class="bd-table">
                                <thead>
                                    <tr>
                                        <th>Client</th>
                                        <th>Document</th>
                                        <th>Expiry</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="documents.records" t-as="doc" t-key="doc.id">
                                        <tr t-on-click="() => openRecord(doc.url)">
                                            <td class="bd-table__title" t-esc="doc.partner"/>
                                            <td t-esc="doc.doc_type"/>
                                            <td t-esc="doc.expires"/>
                                            <td>
                                                <span class="badge" t-att-class="doc.status_class" t-esc="doc.status"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <div class="bd-empty">No expirations in the next 45 days.</div>
                        </t>
                    </article>

                    <article class="bd-panel">
                        <header class="bd-panel__header">
                            <div>
                                <h2 t-esc="followups.title"/>
                                <p>Deals awaiting internal actions.</p>
                            </div>
                            <button t-if="followups.action"
                                    class="bd-link"
                                    type="button"
                                    t-on-click="() => openAction(followups.action, followups.domain)">
                                Open queue
                            </button>
                        </header>
                        <t t-if="followups.items.length">
                            <ul class="bd-followups">
                                <t t-foreach="followups.items" t-as="item" t-key="item.id">
                                    <li class="bd-followups__item" t-on-click="() => openRecord(item.url)">
                                        <div>
                                            <strong t-esc="item.title"/>
                                            <span t-esc="item.client"/>
                                        </div>
                                        <div class="bd-followups__meta">
                                            <span class="badge badge--ghost" t-esc="item.stage"/>
                                            <small t-esc="item.deadline"/>
                                        </div>
                                    </li>
                                </t>
                            </ul>
                        </t>
                        <t t-else="">
                            <div class="bd-empty">Nothing pending right now ðŸŽ‰</div>
                        </t>
                    </article>
                </section>
            </t>
        </div>
    </t>
</templates>
