<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_qlk_task_tree" model="ir.ui.view">
        <field name="name">qlk.task.list</field>
        <field name="model">qlk.task</field>
        <field name="type">list</field>
        <field name="arch" type="xml">
            <list string="Tasks &amp; Hours" default_order="date_start desc">
                <field name="approval_state" widget="badge"/>
                <field name="name"/>
                <field name="department" widget="badge"/>
                <field name="litigation_phase" invisible="department != 'litigation'"/>
                <field name="case_id" invisible="department != 'litigation'"/>
                <field name="engagement_id" invisible="department != 'corporate'"/>
                <field name="employee_id"/>
                <field name="hours_spent"/>
                <field name="date_start"/>
                <field name="date_finished"/>
                <field name="reviewer_id"/>
            </list>
        </field>
    </record>

    <record id="view_qlk_task_form" model="ir.ui.view">
        <field name="name">qlk.task.form</field>
        <field name="model">qlk.task</field>
        <field name="arch" type="xml">
            <form string="Task">
                <sheet>
                    <header>
                        <button name="action_submit_for_approval"
                                type="object"
                                string="Submit for Approval"
                                class="btn-primary"
                                invisible="(approval_state not in ['draft', 'rejected']) or (not can_submit)"/>
                        <button name="action_approve"
                                type="object"
                                string="Approve"
                                class="btn-primary"
                                invisible="(approval_state != 'waiting') or (not can_approve)"/>
                        <button name="action_reject"
                                type="object"
                                string="Reject"
                                class="btn-secondary"
                                invisible="(approval_state != 'waiting') or (not can_approve)"/>
                        <button name="action_mark_draft"
                                type="object"
                                string="Reset to Draft"
                                invisible="approval_state == 'draft'"/>
                        <field name="approval_state" widget="statusbar" statusbar_visible="draft,waiting,approved,rejected"/>
                    </header>

                    <div class="oe_button_box" name="button_box">
                        <button type="object"
                                name="action_open_related_record"
                                string="Related"
                                class="oe_stat_button"
                                icon="fa-external-link"
                                invisible="not department"/>
                    </div>

                    <group>
                        <field name="name"/>
                        <field name="department"/>
                        <field name="litigation_phase" invisible="department != 'litigation'"/>
                        <field name="case_id"
                               context="{'default_department': 'litigation'}"
                               required="department == 'litigation'"
                               invisible="department != 'litigation'"/>
                        <field name="engagement_id"
                               context="{'default_department': 'corporate'}"
                               required="department == 'corporate'"
                               invisible="department != 'corporate'"/>
                        <field name="employee_id"/>
                        <field name="hours_spent"/>
                        <field name="date_start"/>
                        <field name="date_finished"/>
                        <field name="reviewer_id"/>
                    </group>
                    <group>
                        <field name="description" colspan="2"/>
                    </group>
                    <group>
                        <field name="approval_comment" readonly="approval_state == 'approved'"/>
                        <field name="attachment_ids" widget="many2many_binary"/>
                    </group>
                </sheet>

                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_qlk_task_search" model="ir.ui.view">
        <field name="name">qlk.task.search</field>
        <field name="model">qlk.task</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
            <search string="Tasks">
                <field name="name" string="Task" filter_domain="[('name', 'ilike', self)]"/>
                <field name="department" string="Department" filter_domain="[('department', '=', self)]"/>
                <field name="case_id" string="Case" filter_domain="[('case_id', '=', self)]"/>
                <field name="engagement_id" string="Engagement" filter_domain="[('engagement_id', '=', self)]"/>
                <field name="employee_id" string="Employee" filter_domain="[('employee_id', '=', self)]"/>
                <field name="reviewer_id" string="Reviewer" filter_domain="[('reviewer_id', '=', self)]"/>
                <filter name="filter_my_tasks" string="My Tasks" domain="['|', ('assigned_user_id', '=', uid), ('create_uid', '=', uid)]"/>
                <filter name="filter_my_approvals" string="Awaiting My Approval" domain="[('approval_state', '=', 'waiting'), ('reviewer_id', '=', uid)]"/>
                <filter name="filter_waiting" string="Waiting Approval" domain="[('approval_state', '=', 'waiting')]"/>
                <filter name="filter_rejected" string="Returned" domain="[('approval_state', '=', 'rejected')]"/>
                <filter name="filter_approved" string="Approved" domain="[('approval_state', '=', 'approved')]"/>
                <group expand="0" string="Group By">
                    <filter name="group_employee" string="Employee" context="{'group_by': 'employee_id'}"/>
                    <filter name="group_department" string="Department" context="{'group_by': 'department'}"/>
                    <filter name="group_month" string="Month" context="{'group_by': 'month_key'}"/>
                    <filter name="group_week" string="Week" context="{'group_by': 'week_key'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_qlk_task_all" model="ir.actions.act_window">
        <field name="name">All Tasks</field>
        <field name="res_model">qlk.task</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_group_month': 1}</field>
    </record>

    <record id="action_qlk_task_litigation" model="ir.actions.act_window">
        <field name="name">Litigation Tasks</field>
        <field name="res_model">qlk.task</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('department', '=', 'litigation')]</field>
        <field name="context">{'default_department': 'litigation', 'search_default_group_month': 1}</field>
    </record>

    <record id="action_qlk_task_corporate" model="ir.actions.act_window">
        <field name="name">Corporate Tasks</field>
        <field name="res_model">qlk.task</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('department', '=', 'corporate')]</field>
        <field name="context">{'default_department': 'corporate', 'search_default_group_month': 1}</field>
    </record>

    <record id="action_qlk_task_management" model="ir.actions.act_window">
        <field name="name">Management Tasks</field>
        <field name="res_model">qlk.task</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('department', '=', 'management')]</field>
        <field name="context">{'default_department': 'management', 'search_default_group_month': 1}</field>
    </record>
</odoo>
