<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="qlk_management.BDDashboard" owl="1">
        <div class="qlk-bd-dashboard"
             t-att-style="'--qlk-primary: ' + (palette.primary || '#0F5CA8') + '; --qlk-accent: ' + (palette.accent || '#22B6C8') + '; --qlk-muted: ' + (palette.muted || '#0D3E7A') + '; --qlk-success: ' + (palette.success || '#27AE60') + ';'">
            <t t-if="state.loading">
                <div class="qlk-dashboard__loading">
                    <div class="spinner-border text-light" role="status">
                        <span class="sr-only">Loading…</span>
                    </div>
                    <span>Loading BD dashboard…</span>
                </div>
            </t>
            <t t-else="">
                <section class="qlk-project-dashboard__hero">
                    <div class="hero__info">
                        <h1>Business Development Dashboard</h1>
                        <p>Monitor opportunities, proposals, engagement letters, and projects.</p>
                    </div>
                    <div class="hero__metrics">
                        <div class="metric-card">
                            <span>Opportunities</span>
                            <strong t-esc="formatNumber(kpis.opportunities)"/>
                        </div>
                        <div class="metric-card">
                            <span>Proposals</span>
                            <strong t-esc="formatNumber(kpis.proposals)"/>
                        </div>
                        <div class="metric-card">
                            <span>Engagement Letters</span>
                            <strong t-esc="formatNumber(kpis.engagements)"/>
                        </div>
                        <div class="metric-card">
                            <span>Projects</span>
                            <strong t-esc="formatNumber(kpis.projects)"/>
                        </div>
                    </div>
                </section>

                <section class="qlk-project-dashboard__grid">
                    <t t-foreach="sections" t-as="section" t-key="section.key">
                        <article class="qlk-card">
                            <header>
                                <div>
                                    <h2 t-esc="section.title"/>
                                    <small t-esc="section.subtitle"/>
                                </div>
                                <button t-if="section.action"
                                        class="qlk-link"
                                        type="button"
                                        t-on-click="() => openAction(section.action)">
                                    Open
                                </button>
                            </header>
                            <t t-if="section.groups.length">
                                <ul class="qlk-list">
                                    <t t-foreach="section.groups" t-as="group" t-key="group.key">
                                        <li class="qlk-list__item"
                                            t-on-click="() => openAction(section.action, group.domain)">
                                            <div class="item__meta">
                                                <span class="item__name" t-esc="group.label"/>
                                                <span class="item__badge" t-esc="formatNumber(group.count)"/>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar"
                                                     t-att-class="'bg-' + (group.tone || 'primary')"
                                                     t-att-style="'width: ' + group.percent + '%;'"/>
                                            </div>
                                        </li>
                                    </t>
                                </ul>
                            </t>
                            <t t-else="">
                                <div class="qlk-empty">No data found.</div>
                            </t>
                        </article>
                    </t>
                </section>
            </t>
        </div>
    </t>
</templates>
